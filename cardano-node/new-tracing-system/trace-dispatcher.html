<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cardano-node/new-tracing-system/trace-dispatcher" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Tracing system | Cardano node</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://carloslodelar.github.io/documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://carloslodelar.github.io/documentation/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://carloslodelar.github.io/documentation/cardano-node/new-tracing-system/trace-dispatcher"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tracing system | Cardano node"><meta data-rh="true" name="description" content="efficient, simple and flexible program tracing"><meta data-rh="true" property="og:description" content="efficient, simple and flexible program tracing"><meta data-rh="true" name="keywords" content="Get-started,run the node,installation,tracer,tracing,logging,cardano-node,cardano node"><link data-rh="true" rel="icon" href="/documentation/img/cardano.ico"><link data-rh="true" rel="canonical" href="https://carloslodelar.github.io/documentation/cardano-node/new-tracing-system/trace-dispatcher"><link data-rh="true" rel="alternate" href="https://carloslodelar.github.io/documentation/cardano-node/new-tracing-system/trace-dispatcher" hreflang="en"><link data-rh="true" rel="alternate" href="https://carloslodelar.github.io/documentation/cardano-node/new-tracing-system/trace-dispatcher" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/documentation/blog/rss.xml" title="Cardano node RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/documentation/blog/atom.xml" title="Cardano node Atom Feed"><link rel="stylesheet" href="/documentation/assets/css/styles.4981c460.css">
<script src="/documentation/assets/js/runtime~main.5026d6de.js" defer="defer"></script>
<script src="/documentation/assets/js/main.9bcb439f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/cardano-logo.png" alt="cardano docs" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/documentation/img/cardano-logo-darkmode.png" alt="cardano docs" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Documentation</b></a><a class="navbar__item navbar__link" href="/documentation/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/">Welcome</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/documentation/cardano-node/build-from-source">Cardano Node</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/build-from-source">Build from source</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/build-with-nix">Build with nix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/precompiled-binaries">Pre-compiled binaries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/configuration-files">Configuration files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/running-node">Run the node</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/p2p">Peer to peer</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/documentation/cardano-node/new-tracing-system/trace-dispatcher">New tracing system</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentation/cardano-node/new-tracing-system/trace-dispatcher">Tracing system</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/new-tracing-system/trace-messages">Trace messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentation/cardano-node/new-tracing-system/new-tracing-quick-start">Tracing system quick start</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation/cardano-cli/build-cli-from-source">Cardano CLI</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation/plutus/welcomePlutus">Plutus</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/documentation/cardano-devs/ADR/ADR-0-Documenting-Architecture-Decisions">For Cardano Developers</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Cardano Node</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">New tracing system</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tracing system</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>trace-dispatcher</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="efficient-simple-and-flexible-program-tracing">efficient, simple and flexible program tracing<a href="#efficient-simple-and-flexible-program-tracing" class="hash-link" aria-label="Direct link to efficient, simple and flexible program tracing" title="Direct link to efficient, simple and flexible program tracing">​</a></h3>
<p><code>trace-dispatcher</code> is a library that enables definition of <strong>tracing systems</strong> -- systems that collect and manages traces -- as evidence of program execution.</p>
<ul>
<li><a href="#trace-dispatcher-efficient-simple-and-flexible-program-tracing">trace-dispatcher: efficient, simple and flexible program tracing</a></li>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#rationale">Rationale</a></li>
<li><a href="#transition-period">Transition Period</a></li>
<li><a href="#key-recommendations-for-developers">Key Recommendations for Developers</a></li>
</ul>
</li>
<li><a href="#basic-tracer-topics">Basic Tracer Topics</a>
<ul>
<li><a href="#tracer-construction-basics">Tracer Construction Basics</a></li>
<li><a href="#namespace-concept-explanation">Namespace Concept Explanation</a></li>
<li><a href="#typeclasses-overview">Typeclasses Overview</a>
<ul>
<li><a href="#logformatting-typeclass">LogFormatting Typeclass</a></li>
<li><a href="#metatrace-typeclass">MetaTrace Typeclass</a></li>
</ul>
</li>
<li><a href="#metrics-integration">Metrics Integration</a></li>
<li><a href="#frequency-limiting-in-trace-filtering">Frequency Limiting in Trace Filtering</a></li>
<li><a href="#configuration">Configuration</a></li>
</ul>
</li>
<li><a href="#advanced-tracer-topics">Advanced Tracer Topics</a>
<ul>
<li><a href="#integrating-a-new-tracer-into-cardano-node">Integrating a New Tracer into cardano-node</a></li>
<li><a href="#message-filtering-based-on-severity">Message Filtering based on Severity</a></li>
<li><a href="#comprehensive-trace-filtering">Comprehensive Trace Filtering</a></li>
<li><a href="#privacy-annotations">Privacy Annotations</a></li>
<li><a href="#detail-level-in-trace-presentation">Detail Level in Trace Presentation</a></li>
<li><a href="#fold-based-aggregation">Fold-Based Aggregation</a></li>
<li><a href="#dispatcher-routing-mechanism">Dispatcher Routing Mechanism</a></li>
<li><a href="#documentation-generation">Documentation Generation</a></li>
<li><a href="#consistency-checking">Consistency Checking</a></li>
<li><a href="#trace-backends-overview">Trace Backends Overview</a></li>
<li><a href="#data-points-overview-and-deprecation-notice">Data Points Overview and Deprecation Notice</a></li>
</ul>
</li>
<li><a href="#appendix">Appendix</a>
<ul>
<li><a href="#references">References</a></li>
<li><a href="#future-work">Future work</a>
<ul>
<li><a href="#versioning">Versioning</a></li>
<li><a href="#trace-consumers">Trace Consumers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1>Introduction</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="rationale">Rationale<a href="#rationale" class="hash-link" aria-label="Direct link to Rationale" title="Direct link to Rationale">​</a></h2>
<p>The <code>trace-dispatcher</code> library serves as a sophisticated solution for streamlined and effective tracing systems. Built upon the arrow-based <code>contra-tracer</code> framework, it surpasses the capabilities of the <code>iohk-monitoring</code> framework with the following enhancements:</p>
<ul>
<li>
<p>Persistent activation of all tracers, adhering to the configured severity levels.</p>
</li>
<li>
<p>Granular configuration (such as filtering, limiting) of individual tracers based on hierarchical namespaces, extending down to individual messages.</p>
</li>
<li>
<p>Seamless transmission of traces to a dedicated <code>cardano-tracer</code> process capable of handling traces from multiple nodes.</p>
</li>
<li>
<p>Dynamic reconfiguration (i.e. hot-reloading) of tracing settings within a running node (after removal of legacy tracing).</p>
</li>
<li>
<p>Automatic generation of comprehensive documentation encompassing all trace messages, metrics, and datapoints.</p>
</li>
<li>
<p>Sanity and consistency checking of tracer implementations and tracing settings based on the system&#x27;s introspective capability.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="transition-period">Transition Period<a href="#transition-period" class="hash-link" aria-label="Direct link to Transition Period" title="Direct link to Transition Period">​</a></h2>
<p>During the transitional phase, both legacy tracing, based on the <code>iohk-monitoring</code> framework, and new tracing, leveraging <code>trace-dispatcher</code> and <code>cardano-tracer</code>, will coexist.</p>
<p>This interim period provides an opportunity to thoroughly test and enhance the new tracing system. Given the extensive repertoire of over 600 trace messages, the possibility of uncovering regressions and bugs is anticipated. Your assistance in identifying and rectifying these issues is invaluable.</p>
<p>Please be aware that, owing to compatibility with the legacy system, the new tracing functionality will be slightly constrained during this transitional phase. Certain features, such as dynamic reconfiguration of a running node, will be temporarily unavailable. Additionally, there may be redundant implementations that are currently necessary but slated for refinement.</p>
<p>To activate new tracing, set the <code>UseTraceDispatcher</code> in the node&#x27;s config file value to <code>true</code>. When making this switch, ensure that the configuration file includes the requisite values for the new tracing setup, as detailed in the subsequent section.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-recommendations-for-developers">Key Recommendations for Developers<a href="#key-recommendations-for-developers" class="hash-link" aria-label="Direct link to Key Recommendations for Developers" title="Direct link to Key Recommendations for Developers">​</a></h2>
<p>Kindly consider the following important suggestions:</p>
<ul>
<li>
<p>The current tracing system employs two methods for message identification: a hierarchical name known as its Namespace and the Kind field in machine representation. Our implementation is rooted in the namespace, and we are actively moving towards deprecating the Kind field for a singular reliance on namespaces. Therefore, we strongly recommend utilizing namespaces for any trace analysis tools, as the <em>Kind field will be phased out in the near future</em>.</p>
</li>
<li>
<p>Avoid using strictness annotations for trace types. Given that trace messages are either promptly discarded or instantly converted to another format without storage, strictness annotations introduce unnecessary inefficiencies without tangible benefits.</p>
</li>
<li>
<p>When developing new tracers, consider creating the new tracers first and subsequently mapping to old tracers. You can refer to numerous examples in <code>cardano-node</code> under <code>Cardano.Node.Tracing.Tracers</code>.</p>
</li>
<li>
<p>For inquiries and reviews, please reach out to the Performance &amp; Tracing team. Your collaboration and questions are welcome to ensure a seamless transition and optimal utilization of the new tracing framework.</p>
</li>
</ul>
<h1>Basic Tracer Topics</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tracer-construction-basics">Tracer Construction Basics<a href="#tracer-construction-basics" class="hash-link" aria-label="Direct link to Tracer Construction Basics" title="Direct link to Tracer Construction Basics">​</a></h2>
<ol>
<li>Define an Algebraic Data Type (ADT) and assign distinct constructors to each trace message.</li>
</ol>
<p>An example is:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data TraceAddBlockEvent blk =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IgnoreBlockOlderThanK (RealPoint blk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  | IgnoreBlockAlreadyInVolatileDB (RealPoint blk)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="2">
<li>Create a tracer for this data type using the provided Haskell function:</li>
</ol>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- | Generate a tracer conforming to the cardano node requirements.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The tracer must be an instance of LogFormatting for message display</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- and an instance of MetaTrace for meta-information such as</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- severity, privacy, details, and backends.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The tracer receives those backends as arguments:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--   * &#x27;trStdout&#x27;:  stdout tracing</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--   * &#x27;trForward&#x27;: trace forwarding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--   * &#x27;mbTrEkg&#x27;:   (optional) EKG monitoring</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The tracer is supplied with a &#x27;name&#x27; as an array of text, which is prepended to its namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- This function returns the new tracer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkCardanoTracer :: forall evt.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ( LogFormatting evt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , MetaTrace evt )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; Trace IO FormattedMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace IO FormattedMessage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Maybe (Trace IO FormattedMessage)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; [Text]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; IO (Trace IO evt)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is imperative that the tracer backends (the first three parameters) remain consistent across all tracers. For example, only one stdout backend is permitted for use in any program.</p>
<ol start="3">
<li>Configure the returned tracer with:</li>
</ol>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- | Invoke this function during initialization (and potentially later for reconfiguration).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- ConfigReflection is utilized to gather information about the tracers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- and is employed to optimize the tracers.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- TraceConfig represents the configuration, typically loaded from a configuration file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- While it is feasible to provide more than one tracer of the same type,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- this scenario is not common.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- This function does not return a value.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configureTracers :: forall a m.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ( MetaTrace a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , MonadIO m )</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; ConfigReflection</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; TraceConfig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; [Trace m a]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; m ()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ol start="4">
<li>Trace Emission Process</li>
</ol>
<p>To emit a trace, employing a message and its corresponding tracer, utilize the <code>traceWith</code> function:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">traceWith :: Trace m a -&gt; a -&gt; m ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- For example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">addBlockTracer &lt;- mkCardanoTracer trStdout trForward (Just trEkg) [&quot;ChainDB&quot;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">configureTracers configReflect config [addBlockTracer]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traceWith addBlockTracer (IgnoreBlockOlderThanK p)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="namespace-concept-explanation">Namespace Concept Explanation<a href="#namespace-concept-explanation" class="hash-link" aria-label="Direct link to Namespace Concept Explanation" title="Direct link to Namespace Concept Explanation">​</a></h2>
<p>Understanding the concept of namespaces is crucial for comprehending the tracing system and the <code>MetaTrace</code> typeclass. Tracers are systematically organized within a hierarchical tracer namespace, with tree nodes and leaves identified by <code>Text</code> name components.</p>
<p>The trace dispatcher requires careful organization to ensure that all messages possess a unique name within this namespace. Moreover, the same tracer type can be utilized in different contexts, such as for local and remote messages. To enable this flexibility, the &#x27;inner&#x27; namespace is prefixed by the namespace passed to a tracer during construction (refer to <code>mkCardanoTracer</code> example above).</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- A unique identifier for every message, composed of arrays of text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- A namespace can also appear with the tracer name (e.g., &quot;ChainDB.OpenEvent.OpenedDB&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- or more prefixes; currently, a NamespaceOuter is used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The inner namespace may not be empty.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data Namespace a = Namespace {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    nsPrefix :: [Text]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  , nsInner  :: [Text]}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Every namespace is composed of:</p>
<ul>
<li>system namespace (empty for cardano, but was cardano in old tracing)</li>
<li>tracer namespace (argument of mkCardanoTracer)</li>
<li>inner namespace (provided by the MetaTrace typeclass)</li>
</ul>
<p>The tracer namespace serves pivotal roles in:</p>
<ul>
<li>
<p><strong>Documentation</strong>: It defines the overall structure of the generated documentation output.</p>
</li>
<li>
<p><strong>Configuration</strong>: It allows reference to tracers that need reconfiguration, such as altering their severity.</p>
</li>
<li>
<p><strong>Output</strong>: The messages carry the tracer namespace, providing clarity and context in the output.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="typeclasses-overview">Typeclasses Overview<a href="#typeclasses-overview" class="hash-link" aria-label="Direct link to Typeclasses Overview" title="Direct link to Typeclasses Overview">​</a></h2>
<p>For the effective integration of trace messages into the tracing system, two essential typeclasses must be implemented: one for message formatting and another for meta-information.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logformatting-typeclass">LogFormatting Typeclass<a href="#logformatting-typeclass" class="hash-link" aria-label="Direct link to LogFormatting Typeclass" title="Direct link to LogFormatting Typeclass">​</a></h3>
<p>The <code>LogFormatting</code> typeclass governs the presentation of trace messages, encompassing the mapping of traces to metrics and messages. It includes the following methods:</p>
<ul>
<li>
<p>The <code>forMachine</code> method caters to a machine-readable representation, adaptable based on the detail level. Implementation is mandatory for the trace author.</p>
</li>
<li>
<p>The <code>forHuman</code> method renders the message in a human-readable form. Its default implementation is an
empty text, which will be replaced by forMachine in the rendering, if forHuman is empty. The forMachine
will by default rendered with a DNormal detsil level, if no other information is provided.</p>
</li>
<li>
<p>The <code>asMetrics</code> method portrays the message as 0 to n metrics. The default implementation assumes no metrics. Each metric can optionally specify a hierarchical identifier as a <code>[Text]</code>.</p>
</li>
</ul>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class LogFormatting a where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Machine readable representation with varying details based on the detail level.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  forMachine :: DetailLevel -&gt; a -&gt; Aeson.Object</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Human readable representation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  forHuman :: a -&gt; Text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  forHuman _v = &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Metrics representation.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  asMetrics :: a -&gt; [Metric]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  asMetrics _v = []</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Metrics, represented as numbers, serve to monitor the running system and can be accessed, for example, through Prometheus.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data Metric</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Integer metric with a named identifier.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = IntM Text Integer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Double metric with a named identifier.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | DoubleM Text Double</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -- Counter metric with a named identifier and an optional limit.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | CounterM Text (Maybe Int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  deriving (Show, Eq)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="metatrace-typeclass">MetaTrace Typeclass<a href="#metatrace-typeclass" class="hash-link" aria-label="Direct link to MetaTrace Typeclass" title="Direct link to MetaTrace Typeclass">​</a></h3>
<p>The <code>MetaTrace</code> typeclass plays a pivotal role in providing meta-information for trace messages. It includes the following methods:</p>
<ul>
<li>
<p><strong>namespaceFor</strong>: Offers a distinct (inner) namespace for each trace message.</p>
</li>
<li>
<p><strong>severityFor</strong>: Provides severity for a given namespace. As some severities depend not only on the message type but also on the individual message, the actual message may be passed as well.</p>
</li>
<li>
<p><strong>privacyFor</strong>: Determines whether a message is <code>Private</code> or <code>Public</code>. Private messages are not sent to <code>cardano-tracer</code> and are only displayed on the stdout trace. If no implementation is given, <code>Public</code> is chosen.</p>
</li>
<li>
<p><strong>detailsFor</strong>: Specifies the level of details for printing messages. Options include <code>DMinimal</code>, <code>DNormal</code>, <code>DDetailed</code>, and <code>DMaximum</code>. If no implementation is given, <code>DNormal</code> is chosen.</p>
</li>
<li>
<p><strong>documentFor</strong>: Allows the addition of optional documentation for messages as text. See section <a href="#documentation-generation">Documentation Generation</a> later in this document.</p>
</li>
<li>
<p><strong>metricsDocFor</strong>: Enables the addition of documentation for metrics carried by the respective message. If no implementation is given, the default is no metrics.</p>
</li>
<li>
<p><strong>allNamespaces</strong>: Must return an array with all namespaces of this trace type.</p>
</li>
</ul>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class MetaTrace a where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespaceFor  :: a -&gt; Namespace a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  severityFor   :: Namespace a -&gt; Maybe a -&gt; Maybe SeverityS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  privacyFor    :: Namespace a -&gt; Maybe a -&gt; Maybe Privacy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  privacyFor _ _ =  Just Public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  detailsFor    :: Namespace a -&gt; Maybe a -&gt; Maybe DetailLevel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  detailsFor _ _ =  Just DNormal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  documentFor   :: Namespace a -&gt; Maybe Text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metricsDocFor :: Namespace a -&gt; [(Text, Text)]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  metricsDocFor _ = []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  allNamespaces :: [Namespace a]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="metrics-integration">Metrics Integration<a href="#metrics-integration" class="hash-link" aria-label="Direct link to Metrics Integration" title="Direct link to Metrics Integration">​</a></h2>
<p>Metrics are seamlessly incorporated into the system through regular trace messages implementing the <code>asMetrics</code> function within the <code>LogFormatting</code> typeclass. Unlike other trace components, metrics are not subjected to filtering and are consistently provided. This occurs as long as the <code>EKGBackend</code> is configured for the message. The <code>EKGBackend</code> then forwards these metrics to <code>cardano-tracer</code> for additional processing. Subsequently, they are dispatched as Prometheus metrics, extending their utility and visibility.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="frequency-limiting-in-trace-filtering">Frequency Limiting in Trace Filtering<a href="#frequency-limiting-in-trace-filtering" class="hash-link" aria-label="Direct link to Frequency Limiting in Trace Filtering" title="Direct link to Frequency Limiting in Trace Filtering">​</a></h2>
<p>Frequency filtering is an integral aspect of trace filtering, offering an optional mechanism to limit the observable frequency of individual trace messages.</p>
<p>In essence, this involves a fair and probabilistic suppression of messages within a particular trace when their moving-average frequency surpasses a specified threshold parameter.</p>
<p>The frequency limiter, in addition to controlling message frequency, emits a suppression summary message under specific conditions:</p>
<ul>
<li>When message suppression commences.</li>
<li>Every 10 seconds during active limiting, providing the count of suppressed messages.</li>
<li>When message suppression concludes, indicating the total number of suppressed messages.</li>
</ul>
<p>Usually frequency limiters can be just added by configuration, for special cases you
can construct them in your code. Each frequency limiter is assigned a name for identification purposes:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">limitFrequency</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  :: forall a m . MonadUnliftIO m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; Double   -- messages per second</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Text     -- name of this limiter</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m TraceDispatcherMessage -- the limiter&#x27;s messages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a -- the trace subject to limitation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; m (Trace m a) -- the original trace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It is important to note that frequency filtering is designed to be applied selectively to a subset of traces, specifically those identified as potentially noisy. The configuration of frequency limits can thus be tailored to this subset of traces.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2>
<p>The configurability of dispatchers provided by this library relies on:</p>
<ol>
<li>
<p><strong>Tracer Namespace-based Configurability</strong>: Configurable down to single message granularity based on tracer namespaces.</p>
</li>
<li>
<p><strong>Runtime Reconfigurability</strong>: Triggered by invoking <code>configureTracers</code>, enabling changes during program execution.</p>
</li>
</ol>
<p>The usual form to provide a configuration is via a configuration file, wich can be in JSON or YAML format. The options that
can be given based on a namespace are: <code>severity</code>, <code>detail</code>, <code>backends</code> and <code>limiter</code>.</p>
<p>Backends can be a combination of <code>Forwarder</code>, <code>EKGBackend</code>, and
one of <code>Stdout MachineFormat</code>, <code>tdout HumanFormatColoured</code> and <code>Stdout HumanFormatUncoloured</code>.</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Use new tracing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">UseTraceDispatcher</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">True</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">TraceOptions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Options for all tracers, if not overwritten:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Notice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">detail</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DNormal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Stdout MachineFormat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> EKGBackend</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> Forwarder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ChainDB</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Show as well messages with severity Info for all ChainDB traces.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">severity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">detail</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> DDetailed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ChainDB.AddBlockEvent.AddedBlockToQueue</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Limit the AddedBlockToQueue events to a maximum of two per second.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">maxFrequency</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">TraceOptionForwarder</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># Configure the forwarder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">address</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">filePath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /tmp/forwarder.sock</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Initiator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Frequency of Peer messages set to two seconds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">TraceOptionPeerFrequency</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The same in JSON looks like this:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;UseTraceDispatcher&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;TraceOptions&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;severity&quot;: &quot;Notice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;detail&quot;: &quot;DNormal&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;backends&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Stdout MachineFormat&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;EKGBackend&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;Forwarder&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ChainDB&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;severity&quot;: &quot;Info&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;detail&quot;: &quot;DDetailed&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;ChainDB.AddBlockEvent.AddedBlockToQueue&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;maxFrequency&quot;: 2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;TraceOptionForwarder&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;address&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;filePath&quot;: &quot;/tmp/forwarder.sock&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;mode&quot;: &quot;Initiator&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;TraceOptionPeerFrequency&quot;: 2000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For explanations of the trace forwarder option refer to the following document:</p>
<p><a href="https://github.com/input-output-hk/cardano-node-wiki/wiki/New-Tracing-Quickstart" target="_blank" rel="noopener noreferrer">New Tracing Quickstart</a></p>
<p>When <code>TraceOptions</code> is empty, or other entries are missing in the configuration file, default entries are taken from
<a href="https://github.com/intersectmbo/cardano-node/blob/master/cardano-node/src/Cardano/Node/Tracing/DefaultTraceConfig.hs" target="_blank" rel="noopener noreferrer">Cardano.Node.Tracing.DefaultTraceConfig</a> module.</p>
<h1>Advanced Tracer Topics</h1>
<p>The functionality of the new tracing system is composable using basic combinators defined on contravariant tracing.
In this part of the document we introduce the underlying functions. You should look here if you want to
implement some advanced functionality.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="integrating-a-new-tracer-into-cardano-node">Integrating a New Tracer into cardano-node<a href="#integrating-a-new-tracer-into-cardano-node" class="hash-link" aria-label="Direct link to Integrating a New Tracer into cardano-node" title="Direct link to Integrating a New Tracer into cardano-node">​</a></h2>
<p>Presently, the process of adding a new tracer involves making changes in three specific modules. However, we anticipate that this requirement will be simplified once the old tracing system is phased out. The current modules where modifications are needed to add a new tracer are:</p>
<ul>
<li>
<p><strong>Cardano.Node.Tracing.Tracers</strong></p>
</li>
<li>
<p><strong>Cardano.Node.Tracing.Documentation</strong></p>
</li>
<li>
<p><strong>Cardano.Node.Tracing.Consistency</strong></p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="message-filtering-based-on-severity">Message Filtering based on Severity<a href="#message-filtering-based-on-severity" class="hash-link" aria-label="Direct link to Message Filtering based on Severity" title="Direct link to Message Filtering based on Severity">​</a></h2>
<p>The concept of severity in the new system is articulated through an enumeration outlined in <a href="https://tools.ietf.org/html/rfc5424#section-6.2.1" target="_blank" rel="noopener noreferrer">section 6.2.1 of RFC 5424</a>. The severity levels, ranging from the least severe (<code>Debug</code>) to the most severe (<code>Emergency</code>), provide a framework for ignoring messages with severity levels below a globally configured severity cutoff.</p>
<p>To enhance severity filtering, we introduce the option of <code>Silence</code>. This addition allows for the unconditional silencing of a specific trace, essentially representing the deactivation of tracers — a semantic continuation of the functionality in the legacy system.</p>
<p>The following trace combinators play a role in modifying the annotated severity of a trace:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Sets severities for the messages in this trace based on the MetaTrace class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">withSeverity :: forall m a. (Monad m, MetaTrace a) =&gt; Trace m a -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Sets severity for the messages in this trace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">setSeverity :: Monad m =&gt; SeverityS -&gt; Trace m a -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Filters out messages with a severity less than the given one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filterTraceBySeverity :: Monad m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; Maybe SeverityF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When these combinators are applied multiple times to a single trace, only the outermost application has an effect, rendering subsequent applications inconsequential.</p>
<p>In the absence of trace context or configured severity overrides, <code>Info</code> serves as the default severity.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="comprehensive-trace-filtering">Comprehensive Trace Filtering<a href="#comprehensive-trace-filtering" class="hash-link" aria-label="Direct link to Comprehensive Trace Filtering" title="Direct link to Comprehensive Trace Filtering">​</a></h2>
<p>A versatile filtering mechanism is provided, granting access to both the object and a <code>LoggingContext</code>, encompassing the namespace along with optional severity, privacy, and detail level:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Don&#x27;t process further if the result of the selector function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- is False.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filterTrace :: (Monad m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; ((LoggingContext, a) -&gt; Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Context carried by any log message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data LoggingContext = LoggingContext {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lcNSInner   :: [Text]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  , lcNSPrefix  :: [Text]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  , lcSeverity  :: Maybe SeverityS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  , lcPrivacy   :: Maybe Privacy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  , lcDetails   :: Maybe DetailLevel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For instance, you can create a filter function to display only <em>Public</em> messages:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">filterTrace (\(c, _) -&gt; case lcPrivacy c of</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Just s  -&gt; s == Public</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Nothing -&gt; False) -- privacy unknown, don&#x27;t send out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This capability allows for flexible and fine-grained control over the inclusion or exclusion of messages based on a variety of contextual criteria.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="privacy-annotations">Privacy Annotations<a href="#privacy-annotations" class="hash-link" aria-label="Direct link to Privacy Annotations" title="Direct link to Privacy Annotations">​</a></h2>
<p>In our tracing system, privacy annotations empower the distinction of messages that remain within the system and are not sent over the network, but are solely displayed on stdout. This privacy feature is defined through the following enumeration:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data Privacy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = Confidential | Public</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When a trace carries a <strong>Confidential</strong> privacy level, it implies that the trace remains internalized within the system, with the exception of being displayed via standard output.</p>
<p>The annotation mechanism for privacy mirrors that of severity:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Sets privacy for the messages in this trace based on the MetaTrace class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">withPrivacy :: forall m a. (Monad m, MetaTrace a) =&gt; Trace m a -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Sets privacy Confidential for the messages in this trace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">privately :: Monad m =&gt; Trace m a -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Only processes messages further with a privacy greater than the given one</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">filterTraceByPrivacy :: (Monad m) =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Maybe Privacy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In the absence of privacy annotations, <code>Public</code> serves as the default privacy level.</p>
<p>Trace privacy, unlike severity, is not configurable.</p>
<p>Trace filtering responds to privacy context as follows:</p>
<ol>
<li>Traces marked as <code>Confidential</code> can solely reach the <code>stdout</code> trace-out.</li>
<li>Traces marked as <code>Public</code> reach both the <code>stdout</code> and <code>trace-forwarder</code> trace-outs.</li>
</ol>
<p>Effectively, preventing leaks of <code>Confidential</code> traces due to logging misconfiguration is inherent — any potential leak can only occur if the user explicitly permits network access to the standard output of the traced program.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="detail-level-in-trace-presentation">Detail Level in Trace Presentation<a href="#detail-level-in-trace-presentation" class="hash-link" aria-label="Direct link to Detail Level in Trace Presentation" title="Direct link to Detail Level in Trace Presentation">​</a></h2>
<p>A crucial facet of trace presentation is the degree of detail provided for each trace. This consideration holds significance because the generated program traces may inherently include exhaustive details. Presenting every intricate detail in its entirety could impose a considerable burden on trace handling.</p>
<p>To address this, a configurable mechanism for controlling the level of detail is introduced, allowing customization down to specific messages.</p>
<p>The control over detail levels is manifested through the following enumeration:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data DetailLevel = DMinimal | DNormal | DDetailed | DMaximum</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This detail level control ensures that the presentation of traces strikes a balance between informativeness and efficiency, catering to diverse needs and preferences.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fold-based-aggregation">Fold-Based Aggregation<a href="#fold-based-aggregation" class="hash-link" aria-label="Direct link to Fold-Based Aggregation" title="Direct link to Fold-Based Aggregation">​</a></h2>
<p>When there is a need for aggregating information from multiple consecutive messages, the following fold functions can be employed:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Folds the monadic cata function with acc over a.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Uses an MVar to store the state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foldTraceM :: forall a acc m . (MonadUnliftIO m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; (acc -&gt; LoggingContext -&gt; a -&gt; m acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; acc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m (Folding a acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; m (Trace m a)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Like foldTraceM, but filters the trace by a predicate.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foldCondTraceM :: forall a acc m . (MonadUnliftIO m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; (acc -&gt; LoggingContext -&gt; a -&gt; m acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; acc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; (a -&gt; Bool)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m (Folding a acc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; m (Trace m a)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To facilitate typechecking, the <code>Folding</code> type is utilized, and it can be removed by the <code>unfold</code> function:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">newtype Folding a acc = Folding acc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unfold :: Folding a b -&gt; b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unfold (Folding b) = b</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Given that tracers can be invoked from different threads, an <code>MVar</code> is internally employed to ensure correct behavior.</p>
<p>As an illustrative example, let&#x27;s consider a scenario where we want to log a measurement value along with the sum of all measurements recorded thus far. We define a <code>Stats</code> type to store the sum alongside the measurement, and a <code>fold</code>-compatible function to calculate new <code>Stats</code> from old <code>Stats</code> and <code>Measure</code>:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data Stats = Stats {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sMeasure :: Double,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sSum     :: Double</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calculateS :: MonadIO m =&gt; Stats -&gt; LoggingContext -&gt; Double -&gt; m Stats</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">calculateS Stats{..} _ val = pure $ Stats val (sSum + val)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>With these components in place, we can define the aggregation tracer using the <code>foldTraceM</code> procedure. Subsequently, when we log measurement values, the tracer outputs the corresponding <code>Stats</code>:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aggregationTracer &lt;- foldTraceM calculateS (Stats 0.0 0.0) exampleTracer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traceWith 1.1 aggregationTracer -- measure: 1.1 sum: 1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traceWith 2.0 aggregationTracer -- measure: 2.0 sum: 3.1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This demonstrates how fold-based aggregation facilitates the accumulation of information over consecutive messages, enabling insightful data summaries.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dispatcher-routing-mechanism">Dispatcher Routing Mechanism<a href="#dispatcher-routing-mechanism" class="hash-link" aria-label="Direct link to Dispatcher Routing Mechanism" title="Direct link to Dispatcher Routing Mechanism">​</a></h2>
<p>In the process of defining the trace dispatcher, it can be advantageous to employ a set of functions for routing messages. When there&#x27;s a need to dispatch a trace message to different tracers based on specific criteria, the following function proves valuable:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- Allows routing to different tracers, based on the message being processed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- The second argument must mappend all possible tracers of the first</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- argument to one tracer. This is required for the configuration!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">routingTrace :: forall m a. Monad m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; (a -&gt; m (Trace m a))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">let resTrace = routingTrace routingFunction (tracer1 &lt;&gt; tracer2)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  where</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routingFunction LO1 {} = tracer1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    routingFunction LO2 {} = tracer2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>In this context, the second argument must encapsulate the combination (using <code>mappend</code>) of all tracers utilized in the routing trace function into a single tracer. This amalgamation is crucial for the subsequent configuration steps.</p>
<p>While a more secure interface could be constructed using a map of values to tracers, the choice here prioritizes the ability for comprehensive pattern matching. The flexibility offered by full pattern matching outweighs the potential disadvantages, given the context.</p>
<p>Similarly, to route a single trace to multiple tracers simultaneously, the fact that <code>Tracer</code> is a <code>Semigroup</code> allows us to utilize the <code>&lt;&gt;</code> operator or <code>mconcat</code> for lists of tracers:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(&lt;&gt;) :: Monoid m =&gt; m -&gt; m -&gt; m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mconcat :: Monoid m =&gt; [m] -&gt; m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>For instance, to direct messages from one trace to two tracers simultaneously, we can use:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let resTrace = tracer1 &lt;&gt; tracer2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-generation">Documentation Generation<a href="#documentation-generation" class="hash-link" aria-label="Direct link to Documentation Generation" title="Direct link to Documentation Generation">​</a></h2>
<p>The documentation for tracers is periodically generated and can be accessed in the cardano-node-wiki repository at the following path: <a href="https://github.com/input-output-hk/cardano-node-wiki/blob/main/docs/new-tracing/tracers_doc_generated.md" target="_blank" rel="noopener noreferrer">cardano-node-wiki/tracers_doc_generated.md</a>.</p>
<p>To generate the documentation within GHCi, load the <code>Cardano.Node.Tracing.Documentation</code> module and execute the <code>runTraceDocumentationCmd</code> function with the appropriate parameters:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data TraceDocumentationCmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  = TraceDocumentationCmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    { tdcConfigFile :: FilePath -- file path to a node config file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    , tdcOutput     :: FilePath -- file path to output the documentation</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">runTraceDocumentationCmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  :: TraceDocumentationCmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; IO ()</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The self-documentation capabilities of <code>trace-dispatcher</code> rely on documentation annotations provided by the <code>documentFor</code> and <code>metricsDocFor</code> methods within the <code>MetaTrace</code> typeclass. Additionally, a specialized dispatcher execution mode emits documentation for all annotated traces, utilizing the tracer namespace to structure the document.</p>
<p>To generate the documentation, first, call <code>documentTracer</code> for each message type with the associated tracers, then use <code>docuResultsToText</code> with the accumulated lists.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- This function calls document tracers and returns a DocTracer result</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">documentTracer :: forall a.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     MetaTrace a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; Trace IO a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; IO DocTracer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Finally, generate text from all the builders</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">docuResultsToText :: DocTracer -&gt; TraceConfig -&gt; IO Text</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- For example</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b1 &lt;- documentTracer traceForgeEventDocu [t1, t2]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  b2 &lt;- documentTracer .. ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bn &lt;- documentTracer .. ..</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  writeFile &quot;Docu.md&quot; (docuResultsToText (b1 ++ b2 ++ ... ++ bn))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>A generated documentation snippet for a simple message may appear as follows:</p>
<p><strong>Forge.Loop.StartLeadershipCheck</strong></p>
<blockquote>
<p>Start of the leadership check.</p>
</blockquote>
<p>Severity:  <code>Info</code>
Privacy:   <code>Public</code>
Details:   <code>DNormal</code></p>
<p>From the current configuration:</p>
<p>Backends:
<code>EKGBackend</code>,
<code>Stdout MachineFormat</code>,
<code>Forwarder</code>
Filtered <code>Visible</code> by config value: <code>Info</code></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="consistency-checking">Consistency Checking<a href="#consistency-checking" class="hash-link" aria-label="Direct link to Consistency Checking" title="Direct link to Consistency Checking">​</a></h2>
<p>As namespaces are essentially strings, the type system doesn&#x27;t inherently ensure the consistency of namespaces. To address this concern, we have incorporated consistency check functionality into <code>trace-dispatcher</code>. Within the node, you can invoke the following procedure from the <code>Cardano.Node.Tracing.Consistency</code> module. It returns an array of <code>Text</code>, an empty list indicating that everything is in order.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- | Check the configuration in the given file.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- Check the general structure of namespaces.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-- An empty return list means everything is well.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">checkNodeTraceConfiguration ::</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     FilePath -- path to a node configuration file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; IO [Text]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>An example text is &quot;Config namespace error: i.am.an.invalid.namepace&quot; .</p>
<p>This check is performed within a <code>cardano-node</code> test case (<code>Test.Cardano.Tracing.NewTracing.Consistency.tests</code>), ensuring that it is automatically verified with each pull request.</p>
<p>The consistency checks cover the following aspects:</p>
<ul>
<li>
<p>Every namespace in <code>all namespaces</code> must be unique.</p>
</li>
<li>
<p>Each namespace is a terminal and is not a part of another namespace.</p>
</li>
<li>
<p>Namespaces in the <code>severityFor</code>, <code>privacyFor</code>, <code>detailsFor</code>, <code>documentFor</code>, and <code>metricsDocFor</code> functions are consistent with the <code>allNamespaces</code> definition.</p>
</li>
<li>
<p>Any namespace in the configuration must be found by a hierarchical lookup in <code>all namespaces</code>.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="trace-backends-overview">Trace Backends Overview<a href="#trace-backends-overview" class="hash-link" aria-label="Direct link to Trace Backends Overview" title="Direct link to Trace Backends Overview">​</a></h2>
<p>As mentioned earlier, trace backends serve as the final destinations for all traces once they have undergone trace interpretation, resulting in metrics and messages. The system defines three trace backends:</p>
<ol>
<li>
<p><strong>Standard Tracer:</strong> This is the fundamental standard output tracer. Notably, it can accept both regular and confidential traces. It&#x27;s important to construct only one standard tracer in any application, as attempting to create a new one will result in an exception.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">standardTracer :: forall m. (MonadIO m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; m (Trace m FormattedMessage)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Trace-Forward Tracer:</strong> This is a network-only sink dedicated to forwarding messages using typed protocols over TCP or local sockets. It exclusively handles public traces and should be instantiated only once per application.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">forwardTracer :: forall m. (MonadIO m)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; ForwardSink TraceObject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; Trace m FormattedMessage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>EKG Tracer:</strong> This tracer submits metrics to a local EKG store, which then further forwards the messages.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ekgTracer :: MonadIO m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; Either Metrics.Store Server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; m (Trace m FormattedMessage)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ol>
<p>It&#x27;s imperative to note that constructing more than one instance of each tracer in an application may lead to exceptions and should be avoided.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-points-overview-and-deprecation-notice">Data Points Overview and Deprecation Notice<a href="#data-points-overview-and-deprecation-notice" class="hash-link" aria-label="Direct link to Data Points Overview and Deprecation Notice" title="Direct link to Data Points Overview and Deprecation Notice">​</a></h2>
<p>In the imminent future, <code>DataPoint</code>s will be deprecated and replaced by a subscription model.</p>
<p><code>DataPoint</code>s provide a means for processes outside of <code>cardano-node</code> to inquire about the node&#x27;s runtime state. Essentially similar to metrics, <code>DataPoint</code>s, however, have an Algebraic Data Type (ADT) structure, allowing them to represent structured information beyond simple metrics. This feature enables external processes to query and access specific details of a running cardano-node, such as the node&#x27;s basic information.</p>
<p>Implemented as special tracers, <code>DataPoint</code>s package objects into <code>DataPoint</code> constructors and necessitate a <code>ToJSON</code> instance for these objects. The set of <code>DataPoint</code>s provided by the node follows the same namespace structure as metrics and log messages. While <code>DataPoint</code>s operate independently of tracing, they are stored locally, facilitating on-demand queries for the latest values of a specific <code>DataPoint</code>.</p>
<p>It is important to note that DataPoints will soon be deprecated, and a subscription model will take their place. Additionally, detailed information on accepting DataPoints from an external process can be found in <a href="https://github.com/input-output-hk/cardano-node-wiki/wiki/cardano-node-and-DataPoints:-demo" target="_blank" rel="noopener noreferrer">this document</a>. The <a href="https://github.com/intersectmbo/cardano-node/blob/master/cardano-tracer/demo/acceptor.hs" target="_blank" rel="noopener noreferrer"><code>demo-acceptor</code></a> application is available for requesting specific DataPoints by name and displaying their values.</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">-- A simple dataPointTracer supporting the construction of a namespace.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkDataPointTracer :: forall dp. (ToJSON dp, MetaTrace dp, NFData dp)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  =&gt; Trace IO DataPoint</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -&gt; IO (Trace IO dp)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>Appendix</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2>
<p>The following document is periodically regenerated to provide comprehensive documentation for all trace messages, metrics, and data points within <code>cardano-node</code>. It also outlines the handling of these messages based on the current default configuration:</p>
<p><a href="/documentation/cardano-node/new-tracing-system/trace-messages">Generated Cardano Trace Documentation</a></p>
<p>For a quick start for administrators transitioning to new the new tracing system, refer to the following document:</p>
<p><a href="https://github.com/input-output-hk/cardano-node-wiki/wiki/New-Tracing-Quickstart" target="_blank" rel="noopener noreferrer">New Tracing Quickstart</a></p>
<p>Additionally, this document delves into <code>cardano-tracer</code>, a separate application designed for logging and monitoring Cardano nodes:</p>
<p><a href="https://github.com/intersectmbo/cardano-node/blob/master/cardano-tracer/docs/cardano-tracer.md" target="_blank" rel="noopener noreferrer">Cardano Tracer</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-work">Future work<a href="#future-work" class="hash-link" aria-label="Direct link to Future work" title="Direct link to Future work">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="versioning">Versioning<a href="#versioning" class="hash-link" aria-label="Direct link to Versioning" title="Direct link to Versioning">​</a></h3>
<p>Versioning for trace messages stands as a crucial component that significantly contributes to the functionality and maintainability of our system. We acknowledge the importance of associating version numbers with log messages, ensuring transparency and consistency throughout the application lifecycle.</p>
<p>Adhering to a change protocol and establishing a clear correlation between node version numbers and trace version numbers is a prudent strategy. This approach aids in the effective management and communication of updates, alterations, and improvements to our tracing system. Such alignment guarantees that any modifications to the tracing system are accurately reflected and comprehended by both the development team and the broader Cardano community.</p>
<p>Anticipating the forthcoming development phase, we are eager to design and implement this versioning feature. Our goal is to seamlessly integrate it into our overall system architecture, bolstering our capacity to adapt and evolve. This ensures a clear, consistent, and structured approach to trace messages, enhancing our system&#x27;s resilience and comprehensibility.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="trace-consumers">Trace Consumers<a href="#trace-consumers" class="hash-link" aria-label="Direct link to Trace Consumers" title="Direct link to Trace Consumers">​</a></h3>
<p>We are excited to introduce the innovative concept of &quot;trace consumers&quot; into the Cardano Tracer system. This novel approach empowers trace consumers to register with the <code>cardano-tracer</code> application and selectively receive messages based on their subscriptions. We anticipate that this concept will significantly improve the efficiency and flexibility of our tracing system.</p>
<p>The introduction of trace consumers represents a robust and tailored approach to message retrieval, aligning seamlessly with the evolving needs of our network. This concept provides consumers with the ability to specify their message preferences, ensuring that they receive only the data directly relevant to their operations.</p>
<p>As part of this development initiative, we plan to phase out the use of data points. We believe that this evolution will render data points redundant in future versions of the tracing system. The transition to trace consumers aims to streamline our data retrieval processes, eliminating the need for unnecessary data points and offering a more sophisticated and focused mechanism for trace message consumption.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cardano-node/new-tracing-system/tracedispatcher.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/cardano-node/p2p"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Peer to peer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/cardano-node/new-tracing-system/trace-messages"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Trace messages</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#efficient-simple-and-flexible-program-tracing" class="table-of-contents__link toc-highlight">efficient, simple and flexible program tracing</a></li><li><a href="#rationale" class="table-of-contents__link toc-highlight">Rationale</a></li><li><a href="#transition-period" class="table-of-contents__link toc-highlight">Transition Period</a></li><li><a href="#key-recommendations-for-developers" class="table-of-contents__link toc-highlight">Key Recommendations for Developers</a></li><li><a href="#tracer-construction-basics" class="table-of-contents__link toc-highlight">Tracer Construction Basics</a></li><li><a href="#namespace-concept-explanation" class="table-of-contents__link toc-highlight">Namespace Concept Explanation</a></li><li><a href="#typeclasses-overview" class="table-of-contents__link toc-highlight">Typeclasses Overview</a><ul><li><a href="#logformatting-typeclass" class="table-of-contents__link toc-highlight">LogFormatting Typeclass</a></li><li><a href="#metatrace-typeclass" class="table-of-contents__link toc-highlight">MetaTrace Typeclass</a></li></ul></li><li><a href="#metrics-integration" class="table-of-contents__link toc-highlight">Metrics Integration</a></li><li><a href="#frequency-limiting-in-trace-filtering" class="table-of-contents__link toc-highlight">Frequency Limiting in Trace Filtering</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#integrating-a-new-tracer-into-cardano-node" class="table-of-contents__link toc-highlight">Integrating a New Tracer into cardano-node</a></li><li><a href="#message-filtering-based-on-severity" class="table-of-contents__link toc-highlight">Message Filtering based on Severity</a></li><li><a href="#comprehensive-trace-filtering" class="table-of-contents__link toc-highlight">Comprehensive Trace Filtering</a></li><li><a href="#privacy-annotations" class="table-of-contents__link toc-highlight">Privacy Annotations</a></li><li><a href="#detail-level-in-trace-presentation" class="table-of-contents__link toc-highlight">Detail Level in Trace Presentation</a></li><li><a href="#fold-based-aggregation" class="table-of-contents__link toc-highlight">Fold-Based Aggregation</a></li><li><a href="#dispatcher-routing-mechanism" class="table-of-contents__link toc-highlight">Dispatcher Routing Mechanism</a></li><li><a href="#documentation-generation" class="table-of-contents__link toc-highlight">Documentation Generation</a></li><li><a href="#consistency-checking" class="table-of-contents__link toc-highlight">Consistency Checking</a></li><li><a href="#trace-backends-overview" class="table-of-contents__link toc-highlight">Trace Backends Overview</a></li><li><a href="#data-points-overview-and-deprecation-notice" class="table-of-contents__link toc-highlight">Data Points Overview and Deprecation Notice</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li><li><a href="#future-work" class="table-of-contents__link toc-highlight">Future work</a><ul><li><a href="#versioning" class="table-of-contents__link toc-highlight">Versioning</a></li><li><a href="#trace-consumers" class="table-of-contents__link toc-highlight">Trace Consumers</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/documentation/cardano-node/build-from-source">Cardano Node</a></li><li class="footer__item"><a class="footer__link-item" href="/documentation/cardano-cli/build-cli-from-source">Cardano CLI</a></li><li class="footer__item"><a href="https://github.com/IntersectMBO" target="_blank" rel="noopener noreferrer" class="footer__link-item">Contributing<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://cardano.stackexchange.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Exchange<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/z5pURn74N5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/Cardano_CF" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter Cardano Foundation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/InputOutputHK" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter IntersectMBO<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/documentation/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/IntersectMBO" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/IntersectMBO" target="_blank" rel="noopener noreferrer" class="footer__link-item">Disclaimer<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © IOG 2024</div></div></div></footer></div>
</body>
</html>