"use strict";(self.webpackChunknode_cli_docs=self.webpackChunknode_cli_docs||[]).push([[1286],{8618:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>s});var a=o(4848),t=o(8453);const d={},r=void 0,i={id:"cardano-devs/archive/cardano-node-and-DataPoints:-demo",title:"cardano-node-and-DataPoints:-demo",description:"This document provides a step-by-step example of how to work with demo-acceptor.",source:"@site/docs/cardano-devs/archive/cardano-node-and-DataPoints:-demo.md",sourceDirName:"cardano-devs/archive",slug:"/cardano-devs/archive/cardano-node-and-DataPoints:-demo",permalink:"/documentation/cardano-devs/archive/cardano-node-and-DataPoints:-demo",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cardano-devs/archive/cardano-node-and-DataPoints:-demo.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Mixed-Cluster-Integration-test-of-legacy-Cardano-SL-and-Byron-rewrite-node",permalink:"/documentation/cardano-devs/archive/Mixed-Cluster-Integration-test-of-legacy-Cardano-SL-and-Byron-rewrite-node"},next:{title:"CLI-era-command-groups",permalink:"/documentation/cardano-devs/contributing/CLI-era-command-groups"}},c={},s=[{value:"What is it?",id:"what-is-it",level:2},{value:"<code>cardano-node</code>: configuration",id:"cardano-node-configuration",level:2},{value:"<code>demo-acceptor</code>: building",id:"demo-acceptor-building",level:2},{value:"<code>demo-acceptor</code>: running",id:"demo-acceptor-running",level:2},{value:"Examples of <code>DataPoint</code>s",id:"examples-of-datapoints",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["This document provides a step-by-step example of how to work with ",(0,a.jsx)(n.a,{href:"https://github.com/intersectmbo/cardano-node/blob/master/cardano-tracer/demo/acceptor.hs",children:(0,a.jsx)(n.code,{children:"demo-acceptor"})}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"what-is-it",children:"What is it?"}),"\n",(0,a.jsxs)(n.p,{children:["As you know, ",(0,a.jsx)(n.code,{children:"trace-forward"})," library provides a new mini-protocol for working with ",(0,a.jsx)(n.code,{children:"DataPoint"}),"s. And ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," is a small application allowing to ask for arbitrary ",(0,a.jsx)(n.code,{children:"DataPoint"}),". This application is mostly for demonstration/testing if the node provides a particular ",(0,a.jsx)(n.code,{children:"DataPoint"})," or not. If so - its value will be printed out to stdout once per second."]}),"\n",(0,a.jsxs)(n.h2,{id:"cardano-node-configuration",children:[(0,a.jsx)(n.code,{children:"cardano-node"}),": configuration"]}),"\n",(0,a.jsxs)(n.p,{children:["Since ",(0,a.jsx)(n.code,{children:"DataPoint"}),"s are provided by the new tracing infrastructure, please make sure it's enabled in the node's configuration. Open the configuration file and set ",(0,a.jsx)(n.code,{children:"UseTraceDispatcher"})," to ",(0,a.jsx)(n.code,{children:"true"}),". Also, make sure that ",(0,a.jsx)(n.code,{children:"TraceOptionForwarder"})," section contains valid values, for example:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'"TraceOptionForwarder": {\n    "address": {"filePath": "/tmp/forwarder.sock"},\n    "mode" : "Initiator",\n    "queueSize" : 1000,\n    "verbosity" : "Maximum"\n}\n'})}),"\n",(0,a.jsxs)(n.h2,{id:"demo-acceptor-building",children:[(0,a.jsx)(n.code,{children:"demo-acceptor"}),": building"]}),"\n",(0,a.jsxs)(n.p,{children:["Since ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," is a part of ",(0,a.jsx)(n.code,{children:"cardano-tracer"})," project, run this command in order to build it:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"$ cabal build cardano-tracer\n"})}),"\n",(0,a.jsx)(n.p,{children:"Also, you can build it directly:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"$ cabal build exe:demo-acceptor\n"})}),"\n",(0,a.jsxs)(n.p,{children:["As a result, ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," will be built."]}),"\n",(0,a.jsxs)(n.h2,{id:"demo-acceptor-running",children:[(0,a.jsx)(n.code,{children:"demo-acceptor"}),": running"]}),"\n",(0,a.jsxs)(n.p,{children:["Now you can run ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," (it is assumed that you are in the directory with ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," in it):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"$ ./demo-acceptor /tmp/forwarder.sock Responder NodeInfo\n"})}),"\n",(0,a.jsx)(n.p,{children:"where:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"/tmp/forwarder.sock"})," is the path to the local socket. Please make sure it equals the path in ",(0,a.jsx)(n.code,{children:"TraceOptionForwarder.address.filePath"})," from the node's configuration."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"Responder"})," is a network mode for ",(0,a.jsx)(n.code,{children:"demo-acceptor"}),". Currently, it's ",(0,a.jsx)(n.code,{children:"Responder"}),", so ",(0,a.jsx)(n.code,{children:"TraceOptionForwarder.mode"})," from the node's configuration must be ",(0,a.jsx)(n.code,{children:"Initiator"}),"."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"NodeInfo"})," is the name of ",(0,a.jsx)(n.code,{children:"DataPoint"})," we want to ask."]}),"\n"]}),"\n",(0,a.jsxs)(n.h2,{id:"examples-of-datapoints",children:["Examples of ",(0,a.jsx)(n.code,{children:"DataPoint"}),"s"]}),"\n",(0,a.jsxs)(n.p,{children:["After you ran ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," and ",(0,a.jsx)(n.code,{children:"cardano-node"}),", you will see such output for ",(0,a.jsx)(n.code,{children:"NodeInfo"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'DataPoint, name: NodeInfo, raw value: {"niName":"nixos","niCommit":"36bbbae36026dc8dc370b598b061f67ed97008b9","niStartTime":"2022-03-15T18:11:14.412855063Z","niVersion":"1.33.0","niSystemStartTime":"2017-09-23T21:44:51Z","niProtocol":"Byron; Shelley"}\n...\n'})}),"\n",(0,a.jsxs)(n.p,{children:["And this is an example of output for ",(0,a.jsx)(n.code,{children:"NodeState"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'DataPoint, name: NodeState, raw value: {"contents":{"tag":"StartedOpeningImmutableDB"},"tag":"NodeOpeningDbs"}\nDataPoint, name: NodeState, raw value: {"contents":{"tag":"StartedOpeningVolatileDB"},"tag":"NodeOpeningDbs"}\nDataPoint, name: NodeState, raw value: {"contents":"InitChainStartedSelection","tag":"NodeInitChainSelection"}\nDataPoint, name: NodeState, raw value: {"contents":"InitChainSelected","tag":"NodeInitChainSelection"}\nDataPoint, name: NodeState, raw value: {"contents":"InitChainSelected","tag":"NodeInitChainSelection"}\nDataPoint, name: NodeState, raw value: {"contents":[26,20668,0],"tag":"NodeAddBlock"}\nDataPoint, name: NodeState, raw value: {"contents":[26,21014,0],"tag":"NodeAddBlock"}\n...\n'})}),"\n",(0,a.jsxs)(n.p,{children:["As you can see, ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," is displaying received ",(0,a.jsx)(n.code,{children:"DataPoint"})," as a raw ",(0,a.jsx)(n.code,{children:"ByteString"}),". This was made for simplicity: in this case, ",(0,a.jsx)(n.code,{children:"demo-acceptor"})," shouldn't know an actual Haskell type of ",(0,a.jsx)(n.code,{children:"DapaPoint"}),", so it can ask for ",(0,a.jsx)(n.em,{children:"any"})," ",(0,a.jsx)(n.code,{children:"DataPoint"})," provided by ",(0,a.jsx)(n.code,{children:"cardano-node"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>i});var a=o(6540);const t={},d=a.createContext(t);function r(e){const n=a.useContext(d);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(d.Provider,{value:n},e.children)}}}]);